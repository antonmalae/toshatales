# Tosha Tales Backend API

Backend API –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ "–°–∫–∞–∑–∫–∏ –ø—Ä–æ –¢–æ—à—É" - –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–µ—Ç—Å–∫–∏—Ö —Å–∫–∞–∑–æ–∫.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js** - —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Express.js** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Prisma** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
- **JWT** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Joi** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Winston** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Multer** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- **Cloudinary** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- PostgreSQL 12+
- Redis 6+
- npm –∏–ª–∏ yarn

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
   ```bash
   git clone <repository-url>
   cd tosha-tales-backend
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   ```bash
   npm install
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   ```bash
   cp env.example .env
   ```
   
   –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª:
   ```env
   # Server Configuration
   PORT=3001
   NODE_ENV=development
   
   # Database
   DATABASE_URL="postgresql://username:password@localhost:5432/tosha_tales_db"
   
   # Redis
   REDIS_URL="redis://localhost:6379"
   
   # JWT
   JWT_SECRET="your-super-secret-jwt-key-change-this-in-production"
   JWT_EXPIRES_IN="7d"
   
   # Cloudinary
   CLOUDINARY_CLOUD_NAME="your-cloud-name"
   CLOUDINARY_API_KEY="your-api-key"
   CLOUDINARY_API_SECRET="your-api-secret"
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
   ```bash
   # –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
   createdb tosha_tales_db
   
   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
   npm run db:migrate
   
   # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –±–∞–∑—É –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   npm run db:seed
   ```

## üöÄ –ó–∞–ø—É—Å–∫

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
npm run dev
```

### –ü—Ä–æ–¥–∞–∫—à–Ω
```bash
npm run build
npm start
```

## üìö API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/auth/login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `GET /api/auth/me` - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `POST /api/auth/logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### –°–∫–∞–∑–∫–∏
- `GET /api/stories` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∫–∞–∑–æ–∫
- `GET /api/stories/:id` - –ü–æ–ª—É—á–∏—Ç—å —Å–∫–∞–∑–∫—É –ø–æ ID
- `POST /api/stories` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–∫–∞–∑–∫—É (Admin)
- `PUT /api/stories/:id` - –û–±–Ω–æ–≤–∏—Ç—å —Å–∫–∞–∑–∫—É (Admin)
- `DELETE /api/stories/:id` - –£–¥–∞–ª–∏—Ç—å —Å–∫–∞–∑–∫—É (Admin)
- `POST /api/stories/:id/rate` - –û—Ü–µ–Ω–∏—Ç—å —Å–∫–∞–∑–∫—É
- `POST /api/stories/:id/like` - –õ–∞–π–∫–Ω—É—Ç—å/–∞–Ω–ª–∞–π–∫–Ω—É—Ç—å —Å–∫–∞–∑–∫—É

### –ü–µ—Ä—Å–æ–Ω–∞–∂–∏
- `GET /api/characters` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- `GET /api/characters/:id` - –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
- `POST /api/characters` - –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (Admin)
- `PUT /api/characters/:id` - –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (Admin)
- `DELETE /api/characters/:id` - –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (Admin)
- `POST /api/characters/:id/like` - –õ–∞–π–∫–Ω—É—Ç—å/–∞–Ω–ª–∞–π–∫–Ω—É—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- `GET /api/categories` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `POST /api/categories` - –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (Admin)
- `PUT /api/categories/:id` - –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (Admin)
- `DELETE /api/categories/:id` - –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (Admin)

### –†–æ–ª–∏
- `GET /api/roles` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π
- `POST /api/roles` - –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å (Admin)
- `PUT /api/roles/:id` - –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å (Admin)
- `DELETE /api/roles/:id` - –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å (Admin)

### –ú–µ–¥–∏–∞
- `POST /api/media/upload` - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (Admin)
- `GET /api/media` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ (Admin)
- `DELETE /api/media/:id` - –£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª (Admin)

### –ü–æ–∏—Å–∫
- `GET /api/search` - –ü–æ–∏—Å–∫ –ø–æ —Å–∫–∞–∑–∫–∞–º –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –î–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```
Authorization: Bearer <your-jwt-token>
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `stories` - –°–∫–∞–∑–∫–∏
- `characters` - –ü–µ—Ä—Å–æ–Ω–∞–∂–∏
- `categories` - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- `roles` - –†–æ–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

### –°–≤—è–∑—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
- `story_characters` - –°–≤—è–∑—å —Å–∫–∞–∑–æ–∫ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- `story_illustrations` - –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∫ —Å–∫–∞–∑–∫–∞–º
- `story_audio` - –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã —Å–∫–∞–∑–æ–∫
- `story_ratings` - –û—Ü–µ–Ω–∫–∏ —Å–∫–∞–∑–æ–∫
- `story_likes` - –õ–∞–π–∫–∏ —Å–∫–∞–∑–æ–∫
- `character_likes` - –õ–∞–π–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- `media_files` - –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
npm test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
npm run test:watch
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `logs/`:
- `error.log` - –æ—à–∏–±–∫–∏
- `combined.log` - –≤—Å–µ –ª–æ–≥–∏

## üîß –°–∫—Ä–∏–ø—Ç—ã

- `npm run dev` - –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `npm run build` - –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `npm run db:migrate` - –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
- `npm run db:reset` - –°–±—Ä–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `npm run db:seed` - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã–º–∏
- `npm test` - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- `npm run lint` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
- `npm run lint:fix` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

## üë• –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- **USER** - –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—á—Ç–µ–Ω–∏–µ, –ª–∞–π–∫–∏, –æ—Ü–µ–Ω–∫–∏)
- **ADMIN** - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)

## üöÄ –î–µ–ø–ª–æ–π

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞
2. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `npm run db:migrate`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `npm start`

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License 